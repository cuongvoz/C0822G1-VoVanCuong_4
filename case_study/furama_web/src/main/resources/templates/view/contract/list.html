<!DOCTYPE html>
<html lang="en">
<head th:replace="~{layout :: head('Contact')}">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:replace="~{layout :: header}"></div>
<div class="row">
    <nav class="navbar navbar-light" style="background-color: teal">
        <div class="container-fluid" style="position: relative">
            <a class="navbar-brand"
               th:href="@{/}">Home</a>

            <button class="btn btn-light" style="position: absolute;left: 100px" data-bs-toggle="modal"
                    data-bs-target="#addmodal">Tạo Hợp Đồng
            </button>
            <form action="/contract/find" method="get" style="position:absolute ;top: 1px;right: 30px"
                  class="d-flex">
                <input class="form-control me-2" type="search" name="facility" placeholder="Dịch Vụ"
                       aria-label="Search">
                <input class="form-control me-2" type="search" name="customer" placeholder="Khách Hàng"
                       aria-label="Search">
                <input class="form-control me-2" type="search" name="employee" placeholder="Nhân Viên"
                       aria-label="Search">
                <button class="btn btn-outline-light" type="submit">Tìm</button>
            </form>
        </div>
    </nav>
</div>
<div class="bgimg">
    <br> <br> <br>
    <table class="table" style="backdrop-filter: blur(10px);color: aliceblue;font-weight: bold">
        <thead>
        <tr>
            <th>#</th>
            <th>Dịch Vụ</th>
            <th>Nhân Viên</th>
            <th>Khách Hàng</th>
            <th>Ngày Bắt Đầu</th>
            <th>Ngày Kết Thúc</th>
            <th>Tiền Đặt Cọc</th>
            <th>Tổng Tiền</th>
            <th>Các Dịch Vụ Đi Kèm</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="contract,status : ${list}">
            <td th:text="${status.count}"></td>
            <td th:text="${contract.facility.name}"></td>
            <td th:text="${contract.employee.name}"></td>
            <td th:text="${contract.customer.name}"></td>
            <td th:text="${contract.startDate}"></td>
            <td th:text="${contract.endDate}"></td>
            <td th:text="${contract.deposit}"></td>
            <td th:text="200000"></td>
            <td>
                <button class="btn btn-outline-light" th:attr="onclick=|addAttach('${contract.id}')|" data-bs-toggle="modal" data-bs-target="#addDetail">+</button> &nbsp;&nbsp;
                <a th:href="@{/contract/view/__${contract.id}__}" class="btn btn-outline-light">Danh Sách Các Dịch Vụ Đi
                    Kèm</a>
            </td>
        </tr>
        </tbody>
    </table>
    <div th:replace="~{layout :: footer}"></div>
</div>
<div class="modal" tabindex="-1" id="addDetail">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm dịch vụ đi kèm <i class="fa-sharp fa-solid fa-user"></i></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/contract/add}" method="post" th:object="${contractDetail}">

                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Dịch Vụ</label>
                        <div class="col-sm-10">
                            <select th:field="*{attachFacility}" class="form-control">
                                <option th:each="facility : ${listAttach}" th:text="${facility.name}" th:value="${facility.id}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Số Lượng</label>
                        <input type="hidden" th:field="*{contract}" id="contractIdAdd">
                        <div class="col-sm-10">
                            <input type="number" class="form-control" th:field="*{quantity}">
                        </div>
                    </div>


                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Thêm</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div class="modal" tabindex="-1" id="viewAttachFacility">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Dịch Vụ Đi Kèm Của Hợp Đồng Này</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <input type="hidden" th:value="${modal}" id="modalCheck">
            <div class="modal-body">
                <table class="table">
                    <thead >
                    <tr>
                    <th>#</th>
                    <th>Dịch Vụ</th>
                    <th>Đơn Giá</th>
                    <th>Xuất</th>
                    <th>Trạng Thái</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="facility,status : ${listAttachFacilityOf}">
                        <th th:text="${status.count}">#</th>
                        <th th:text="${facility.name}">Dịch Vụ</th>
                        <th th:text="${facility.cost}">Đơn Giá</th>
                        <th th:text="${facility.unit}">Xuất</th>
                        <th th:text="${facility.status}">Trạng Thái</th>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Thoát</button>
            </div>
        </div>
    </div>
</div>
<div class="modal" tabindex="-1" id="addmodal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tạo Hợp Đồng <i class="fa-sharp fa-solid fa-user"></i></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form th:action="@{/contract/addContract}" method="post" th:object="${contract}">
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Ngày Bắt Đầu</label>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" th:field="*{startDate}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Ngày Kết Thúc</label>
                        <div class="col-sm-10">
                            <input type="date" class="form-control" th:field="*{endDate}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Tiền Gửi</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" th:field="*{deposit}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Tổng Tiền</label>
                        <div class="col-sm-10">
                            <input type="number" class="form-control" readonly id="tongTien">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Khách Hàng</label>
                        <div class="col-sm-10">
                            <select class="form-control" th:field="*{customer}">
                                <option th:each="customer : ${customerList}" th:text="${customer.name}" th:value="${customer.id}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Nhân Viên</label>
                        <div class="col-sm-10">
                            <select class="form-control" th:field="*{employee}">
                                <option th:each="employee : ${employeeList}" th:text="${employee.name}" th:value="${employee.id}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Dịch Vụ</label>
                        <div class="col-sm-10">
                            <select class="form-control" th:field="*{facility}">
                                <option th:each="facility : ${facilityList}" th:text="${facility.name}" th:value="${facility.id}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-2 col-form-label">Dịch Vụ Đi Kèm</label>
                        <div class="col-sm-10">
                            <button class="btn btn-primary" >+</button>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-primary">Xác Nhận</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"> </script>
<script>
    function addAttach(id) {
        document.getElementById("contractIdAdd").value = id;
    }

    let modal = document.getElementById("modalCheck").value;
    if (modal == "true") {
        $(document).ready(
            function () {
                $('#viewAttachFacility').appendTo('body').modal('show')
            }
        )
    }
</script>
</html>